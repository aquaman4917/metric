# ============================================================
# Brain Control Architecture Pipeline - Configuration
# ============================================================

# --- Paths ---
paths:
  input_mat: "HCP_NKI_merged"
  input_search_dirs:
    - "data/brainnetome"
  output_dir: "results"
  subregion_file: "data/brainnetome/BNA_subregions.xlsx"

# --- Preprocessing ---
# threshold_method: how to binarise the connectivity matrix
#   "proportional"  — keep top *density* fraction of edges (default)
#   "absolute"      — keep edges with |w| >= absolute_threshold
#   "mst"           — minimum spanning tree + top density fill
preprocessing:
  threshold_method: "proportional"    # "proportional" | "absolute" | "mst"
  absolute_threshold: null            # used only when method = "absolute"
  mdset_method: "greedy"              # "greedy" (fast, ~5ms) | "ilp" (exact, minutes)

# --- Network Parameters ---
network:
  net_size: 246               # Brainnetome atlas node count
  density: 0.20               # proportional threshold (top 20% edges)
  frac: 0.05                  # DC: top 5% high-degree nodes
  pc_threshold: 0.50          # Provincial <= 0.5, Connector > 0.5
  frac_search_range: [0.01, 0.50, 0.01]  # start, stop, step for newDC
  null_n: 20                 # number of null graphs per subject (start with 30~50 to test)
  null_swaps_per_edge: 10     # Maslov–Sneppen swaps per edge
  null_seed: 0                # reproducibility (optional)

# --- Metrics (on/off) ---
metrics:
  MDS_size: true
  Deg_conc: true
  DC: true
  OCA: true
  OCA_norm: true
  # Enable the new Normalized Overlap Redundancy (NOR) metric by default
  NOR: true
  DC_cz: true
  OCA_cz: true
  OCA_norm_cz: false
  OCA_P_cz: false
  OCA_C_cz: false
  DC_PC_cz: false
  OCA_P_norm_cz: false
  OCA_C_norm_cz: false
  Prov_ratio_cz: false
  Deg_conc_cz: false
  newDC_cz: false
  DC_z: false
  OCA_z: false
  newDC: true
  DC_PC: true
  OCA_P: true
  OCA_C: true
  Prov_ratio: true

# --- Subregion ---
# null = whole brain. Or specify label from BNA_subregions.xlsx
subregion:
  nodes: null                 # e.g., [0, 1, 2, ..., 51] (0-indexed)
  label: "whole"

# --- Age ---
age:
  unit: "year"                # MAT age is in years
  bins:                        # manual bins (years). null = auto
    - [0, 21,   "dev"]
    - [22, 35,  "ya"]
    - [36, 44, "mature"]
    - [45, 59, "peri"]
    - [59, 79, "old"]
    - [80, 200, "very-old"]
  auto_bins:
    count: 5
    method: "quantile"        # 'quantile' or 'equal'

# --- Statistics ---
stats:
  alpha: 0.05
  correction: "bonferroni"    # 'none', 'bonferroni', 'fdr'
  trend_model: "linear"       # 'linear', 'quadratic'
  partial_corr_age:
    enabled: true
    covariates: ["MDS_size"]  # columns to control for
  mds_conditional_zscore:
    n_bins: 10
    min_bin_n: 20
    mds_col: "MDS_size"

# --- Subject QC (consensus-style) ---
qc:
  method: "none"              # 'zscore', 'iqr', 'none'
  zscore_threshold: 3.0
  iqr_factor: 1.5
  min_metrics: 1              # minimum valid metric count per subject

# --- Visualization ---
viz:
  save_fig: true
  save_png: true
  dpi: 300
  scatter_alpha: 0.5
  colormap: "viridis"

# --- Computation ---
compute:
  parallel: true
  n_jobs: -1                  # -1 = all cores
